# ADR-001: Initial Architecture Decision — Serverless AWS Stack

**Статус:** Принято  
**Дата:** 2025-12-22  
**Автор:** ARCHITECT  
**Участники:** OWNER, ANALYST  
**Источник требований:** `docs/requirements/PRD.md` (PRD 2.1) — единственный источник истины для всех агентов

---

## Контекст

Flow Logic — B2C платформа для оценки качества движения через MediaPipe и коррекции через AI-план. Требуется выбрать архитектуру, которая обеспечит:
- Низкую стоимость на старте (MVP: ≤ $50/мес)
- Масштабируемость (0-5000+ пользователей)
- Быстрое время разработки
- Production-grade надежность

## Решение

Выбрана **serverless архитектура на AWS** с использованием:
- **Frontend:** React на Vercel
- **Backend:** AWS Lambda + API Gateway
- **Database:** DynamoDB (NoSQL)
- **Storage:** S3 для видео
- **Auth:** AWS Cognito
- **Messaging:** EventBridge + SQS

## Обоснование

### Преимущества

1. **Низкая стоимость на старте**
   - PAY_PER_REQUEST для DynamoDB (нет idle costs)
   - Lambda оплата только за использование
   - S3 storage по мере необходимости
   - **Результат:** MVP может стоить < $50/мес при 0-100 пользователях

2. **Автоматическое масштабирование**
   - Lambda автоматически масштабируется
   - DynamoDB on-demand режим
   - Не требует управления серверами
   - **Результат:** Поддержка 0-5000+ пользователей без изменений

3. **Быстрое время разработки**
   - Serverless Framework упрощает деплой
   - Vercel автоматизирует frontend deployment
   - Меньше инфраструктурного кода
   - **Результат:** MVP за 2-3 месяца

4. **Production-grade надежность**
   - AWS SLA (99.99% uptime)
   - Автоматические бэкапы (DynamoDB PITR)
   - Встроенный мониторинг (CloudWatch)
   - **Результат:** Готовность к production

5. **Event-driven архитектура**
   - EventBridge для loose coupling
   - SQS для retry logic
   - **Результат:** Устойчивость к сбоям

### Недостатки

1. **Vendor Lock-in**
   - Зависимость от AWS сервисов
   - **Митигация:** Использование стандартных протоколов (REST API, JWT)

2. **Cold Start Latency**
   - Lambda cold starts могут быть медленными
   - **Митигация:** ARM64 архитектура, provisioned concurrency (опционально)

3. **DynamoDB ограничения**
   - NoSQL может быть сложнее для сложных queries
   - **Митигация:** Правильный design access patterns, GSI

4. **Debugging сложность**
   - Распределенная система сложнее для отладки
   - **Митигация:** X-Ray tracing, structured logging

## Альтернативы

### Альтернатива 1: Traditional Server Architecture (EC2 + RDS)
- **Плюсы:** Полный контроль, нет vendor lock-in
- **Минусы:** Высокая стоимость на старте, требует DevOps экспертизы
- **Решение:** Отклонено из-за стоимости и сложности

### Альтернатива 2: Container-based (ECS/EKS + RDS)
- **Плюсы:** Гибкость, портируемость
- **Минусы:** Сложность управления, высокая стоимость
- **Решение:** Отклонено из-за сложности для MVP

### Альтернатива 3: Firebase / Supabase
- **Плюсы:** Простота, быстрый старт
- **Минусы:** Ограниченная кастомизация, возможные проблемы с масштабированием
- **Решение:** Отклонено из-за ограничений в обработке видео

## Последствия

### Положительные
- ✅ Низкая стоимость на старте
- ✅ Быстрое время разработки
- ✅ Автоматическое масштабирование
- ✅ Production-ready инфраструктура

### Отрицательные
- ⚠️ Vendor lock-in (AWS)
- ⚠️ Необходимость изучения AWS сервисов
- ⚠️ Cold start latency (минимальное влияние)

### Риски
- **Риск:** Высокая стоимость при росте
  - **Митигация:** Cost monitoring, optimization strategies
- **Риск:** Сложность отладки
  - **Митигация:** Comprehensive logging, X-Ray

## Метрики успеха

- **Cost:** MVP ≤ $50/мес (0-100 users)
- **Performance:** API latency p95 < 500ms
- **Reliability:** Uptime > 99.9%
- **Time to Market:** MVP за 2-3 месяца

## Связанные решения

- ADR-002: Выбор DynamoDB vs RDS (будет создан при необходимости)
- ADR-003: Выбор MediaPipe для video processing (уже определен в PRD)

---

**Следующие шаги:**
1. Настроить AWS аккаунт и IAM роли
2. Создать Serverless Framework проект
3. Настроить CI/CD pipeline
4. Развернуть staging окружение

