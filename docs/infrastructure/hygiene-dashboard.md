# Infrastructure Hygiene Dashboard

## Overview

This dashboard tracks infrastructure hygiene metrics and compliance status for AWS resources in the Flow Logic project.

## Metrics

### Compliance Rate

**Target:** 100% for new resources, 95%+ overall

- **Compliant Resources:** Resources with all required tags and correct naming
- **Non-Compliant Resources:** Resources missing required tags or violating naming conventions
- **Untagged Resources:** Resources without required tags (Project, Env, Owner)

**Formula:** `(Compliant Resources / Total Resources) × 100%`

### Cost Optimization

**Target:** 20-40% cost reduction after cleanup

- **Total AWS Spend:** Monthly AWS bill
- **Untagged Resources Cost:** Estimated cost of untagged resources
- **Expired Dev Resources Cost:** Cost of expired dev resources (should be 0 after cleanup)
- **Cost by Environment:** Breakdown of spend by prod/staging/dev

**Tracking:**
- Daily: Inventory scan results
- Weekly: Cost analysis report
- Monthly: Cost optimization review

### Operational Health

**Target:** 0 expired dev resources, <5% untagged resources

- **Expired Dev Resources:** Dev resources past ExpiresAt date
- **Resources Older Than 90 Days:** Resources without usage for 90+ days (cost zombies)
- **Resources by Age:** Distribution of resource ages

## Dashboards

### Daily Compliance Status

Run: `./scripts/infrastructure-compliance-check.sh`

**Metrics:**
- Total resources scanned
- Compliant count
- Non-compliant count
- Violations by type (untagged, expired, naming)

### Weekly Inventory Report

Run: `./scripts/aws-inventory-scan.sh && python3 scripts/aws-inventory-classifier.py inventory-*.json`

**Metrics:**
- Resources by environment (prod/staging/dev/untagged)
- Resources by type (Lambda, DynamoDB, S3, etc.)
- Age distribution
- Tag compliance rate

### Monthly Cleanup Plan

Run: `./scripts/generate-cleanup-plan.sh`

**Metrics:**
- Expired dev resources (candidates for cleanup)
- Untagged resources (candidates for tagging)
- Estimated cost savings from cleanup

## Key Performance Indicators (KPIs)

| Metric | Target | Current | Status |
|--------|--------|---------|--------|
| Compliance Rate (new resources) | 100% | - | ⚠️ Baseline |
| Compliance Rate (overall) | 95%+ | - | ⚠️ Baseline |
| Untagged Resources | 0 | - | ⚠️ Baseline |
| Expired Dev Resources | 0 | - | ⚠️ Baseline |
| Cost Reduction | 20-40% | - | ⚠️ Baseline |

## Reports

### Compliance Report

Generated by: `infrastructure-compliance-check.sh`

**Contains:**
- Summary of violations by type
- List of non-compliant resources
- Recommendations for fixes

### Inventory Report

Generated by: `aws-inventory-scan.sh` + `aws-inventory-classifier.py`

**Contains:**
- Complete resource inventory
- Classification by environment and type
- Tag compliance status
- Resource ages

### Cleanup Plan

Generated by: `generate-cleanup-plan.sh`

**Contains:**
- List of resources recommended for cleanup
- Safety level for each resource
- Backup requirements
- Estimated cost savings

## Monitoring

### GitHub Actions

- **Daily:** Automated compliance check via scheduled workflow
- **On Push:** Compliance check for infrastructure changes
- **On PR:** Pre-merge validation

### Beads Issues

Automatically created for:
- Untagged resources (high priority)
- Expired dev resources (medium priority)
- Compliance violations (medium priority)

**View issues:** `bd list --type infrastructure`

## Alerts

### Critical Alerts

- Production resources missing required tags
- Untagged resources cost > $100/month
- Compliance rate drops below 90%

### Warning Alerts

- Expired dev resources count > 5
- Untagged resources count > 10
- Compliance rate drops below 95%

## Runbooks

### Fixing Compliance Violations

1. **Identify violations:** `./scripts/infrastructure-compliance-check.sh`
2. **Review violations:** Check Beads issues for details
3. **Add tags:** Use AWS Console or CLI to add required tags
4. **Fix naming:** Update resource names to follow convention (if possible)
5. **Verify fix:** Re-run compliance check

### Cleaning Up Expired Dev Resources

1. **Generate cleanup plan:** `./scripts/generate-cleanup-plan.sh`
2. **Review plan:** `cat cleanup-plan-*.json | jq`
3. **Dry-run cleanup:** `python3 scripts/safe-aws-cleanup.py --plan cleanup-plan-*.json --dry-run`
4. **Execute cleanup:** `python3 scripts/safe-aws-cleanup.py --plan cleanup-plan-*.json`
5. **Verify cleanup:** Re-run inventory scan

### Tagging Untagged Resources

1. **Identify untagged resources:** `./scripts/infrastructure-compliance-check.sh`
2. **Determine environment:** Review resource name/usage
3. **Add required tags:**
   - `Project=flowlogic`
   - `Env=<dev|staging|prod>`
   - `Owner=<email|team>`
   - `ExpiresAt=<ISO8601>` (for dev resources)
4. **Verify tags:** Re-run compliance check

## References

- **Infrastructure Spec:** `infrastructure/infrastructure-spec.yaml`
- **Inventory Config:** `infrastructure/aws-inventory-config.yaml`
- **Scripts:** `scripts/aws-inventory-*.sh`, `scripts/infrastructure-compliance-check.sh`
