# S4: INCIDENT_RECOVERY - Автоматическое восстановление при ошибках
scenario: INCIDENT_RECOVERY

phases:
  FREEZE:
    description: "Заморозка (остановка деплоев, фиксация состояния)"
    allowed_actions:
      - freeze_deployments
      - create_backup
      - log_incident
    auto_scripts:
      - scripts/freeze_deployments.sh
    next_phase: ROLLBACK
    active_role: INFRA_DEVOPS

  ROLLBACK:
    description: "Откат к стабильному состоянию (автоматически, без диалогов)"
    allowed_actions:
      - rollback_code
      - disable_features
      - restore_backup
    auto_scripts:
      - scripts/rollback_stage.sh
    next_phase: VERIFY
    active_role: SYSTEM

  VERIFY:
    description: "Проверка восстановления"
    allowed_actions:
      - verify_recovery
      - run_smoke_tests
      - check_health
    auto_scripts:
      - scripts/verify_recovery.sh
    next_phase: RESTORE
    active_role: QA

  RESTORE:
    description: "Восстановление (опционально)"
    allowed_actions:
      - restore_services
      - re_enable_features
      - update_docs
    auto_scripts: []
    next_phase: null
    active_role: INFRA_DEVOPS

